<!DOCTYPE html>
<html>
<head>
  <title>Buy Voucher</title>
</head>
<body>
  <h2>Buy Voucher</h2>
  <form id="buyForm">
    <input name="ref" placeholder="GCash Reference Number" required />
    <input name="phone" placeholder="Your Mobile Number" required />
    <button type="submit">Submit</button>
  </form>

  <div id="loading" style="display:none">‚è≥ Waiting for confirmation...</div>
  <div id="voucher" style="display:none; font-size: 24px; margin-top: 10px;"></div>

  <script>
    const form = document.getElementById('buyForm');
    form.onsubmit = async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      document.getElementById('loading').style.display = 'block';

      const res = await fetch('/submit', {
        method: 'POST',
        body: formData
      });
      const { id } = await res.json();

      const interval = setInterval(async () => {
        const r = await fetch('/check?id=' + id);
        const data = await r.json();
        if (data.voucher) {
          clearInterval(interval);
          document.getElementById('loading').style.display = 'none';
          document.getElementById('voucher').innerText = "üéüÔ∏è Your Voucher Code: " + data.voucher;
          document.getElementById('voucher').style.display = 'block';
        }
      }, 5000);
    };
  </script>
</body>
</html>
